<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Danmaku Typing</title>
    <link rel="stylesheet" href="style.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Zen+Kaku+Gothic+New:wght@400;700&display=swap');
    </style>
</head>

<body>
    <div id="game-container">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div id="error-log"></div>

        <!-- UI Overlay -->
        <div id="ui-layer">
            <div id="hud" class="hidden">
                <div class="hud-item">HP: <span id="hp-display">100%</span></div>
                <div class="hud-item">Lives: <span id="lives-display">‚ù§‚ù§‚ù§</span></div>
                <div class="hud-item">Boss: <span id="boss-hp">100%</span></div>
                <div class="hud-item">Task: <span id="current-task">DODGE</span></div>
            </div>

            <div id="start-screen">
                <h1>BRAIN DANMAKU TYPING</h1>
                <p>ËÑ≥„Éà„É¨ x ÂºæÂπï x „Çø„Ç§„Éî„É≥„Ç∞</p>

                <div id="player-setup">
                    <label>PLAYER NAME:</label>
                    <input type="text" id="player-name-input" placeholder="Guest" maxlength="10">
                </div>

                <div id="ranking-container">
                    <h3>TOP RANKING</h3>
                    <table id="ranking-table">
                        <thead>
                            <tr>
                                <th>RK</th>
                                <th>NAME</th>
                                <th>TIME</th>
                                <th>‚ù§Ô∏è</th>
                            </tr>
                        </thead>
                        <tbody id="ranking-body">
                            <tr>
                                <td colspan="4">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>



                <button id="start-btn">GAME START</button>
            </div>

            <div id="game-over-screen" class="hidden">
                <h1>GAME OVER</h1>
                <button id="retry-btn">RETRY BOSS</button>
            </div>

            <div id="victory-screen" class="hidden">
                <h1>VICTORY</h1>
                <p>All Bosses Defeated!</p>
                <p id="final-score">Time: --:-- | Lives: --</p>
                <p id="ranking-status">Sending Score...</p>
                <button onclick="location.reload()">TITLE</button>
            </div>

            <!-- Typing Input (Invisible but focused) -->
            <input type="text" id="typing-input" autocomplete="off" spellcheck="false">

            <div id="typing-display" class="hidden">
                <div id="typing-question">ÂïèÈ°åÊñá</div>
                <div id="typing-romaji"><span class="typed">kore</span><span class="untyped">kara</span></div>
            </div>

            <!-- Brain Training Instruction Overlay -->
            <div id="brain-instruction" class="hidden">
                <div id="instruction-text">Âãù„Å¶ÔºÅ</div>
                <div id="counting-box" class="hidden">üì¶</div>
            </div>

            <div id="hide-box" class="hidden">BLOCKED</div>

            <div id="now-playing" class="hidden">‚ô™ <span id="song-name">Song Name</span></div>
        </div>
    </div>

    <script>
        window.onerror = function (msg, url, line, col, error) {
            const log = document.getElementById('error-log');
            if (log) {
                log.innerText += `[ERROR] ${msg}\nAt: ${url}:${line}:${col}\n\n`;
                if (msg.includes('Access to script') && msg.includes('CORS')) {
                    log.innerText += "„ÄêÈáçË¶Å„Äë„É≠„Éº„Ç´„É´„Éï„Ç°„Ç§„É´(file://)„ÅßÈñã„ÅÑ„Å¶„ÅÑ„Çã„Åü„ÇÅ„ÄÅJavaScript„Åå„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü„ÄÇ\n" +
                        "VSCode„ÅÆ 'Live Server' Êã°ÂºµÊ©üËÉΩ„Çí‰Ωø„ÅÜ„Åã„ÄÅ„É≠„Éº„Ç´„É´„Çµ„Éº„Éê„ÉºÁµåÁî±„ÅßÈñã„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n" +
                        "„Åæ„Åü„ÅØ„ÄÅFirefox„Çí‰ΩøÁî®„Åô„Çã„Å®Âãï„ÅèÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ\n";
                }
            }
            return false;
        };
        window.addEventListener('unhandledrejection', function (event) {
            const log = document.getElementById('error-log');
            if (log) log.innerText += `[PROMISE] ${event.reason}\n\n`;
        });
    </script>
    <script src="js/Typing/RomajiConverter.js"></script>
    <script src="js/Typing/TypingLogic.js"></script>
    <script src="js/BrainGame/BrainTaskManager.js"></script>
    <script src="js/RankingManager.js"></script>
    <script src="js/InputHandler.js"></script>
    <script src="js/SoundManager.js"></script>
    <script src="js/BulletManager.js"></script>
    <script src="js/Player.js"></script>
    <script src="js/Game.js"></script>
    <script src="js/main.js"></script>
</body>

</html>